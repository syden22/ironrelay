<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>IronRelay Dashboard</title>
    <style>
        body {
            margin: 0;
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            background: #0f172a;
            color: #e5e7eb;
        }
        .layout {
            max-width: 1200px;
            margin: 0 auto;
            padding: 24px;
        }
        h1 { font-size: 28px; margin-bottom: 4px; }
        .subtitle { color: #9ca3af; margin-bottom: 24px; }
        .cards {
            display: grid;
            grid-template-columns: repeat(4, minmax(0, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }
        .card {
            background: #020617;
            border-radius: 16px;
            padding: 16px;
            box-shadow: 0 10px 25px rgba(15,23,42,0.9);
        }
        .card-title {
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: .08em;
            color: #9ca3af;
            margin-bottom: 8px;
        }
        .card-value { font-size: 24px; font-weight: 600; }
        .card-note { margin-top: 4px; font-size: 11px; color: #6b7280; }
        .grid {
            display: grid;
            grid-template-columns: repeat(3, minmax(0, 1fr));
            gap: 16px;
        }
        .panel {
            background: #020617;
            border-radius: 16px;
            padding: 16px;
            box-shadow: 0 10px 25px rgba(15,23,42,0.9);
        }
        .panel h2 { font-size: 16px; margin: 0 0 12px 0; }
        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 12px;
        }
        th, td {
            padding: 6px 8px;
            border-bottom: 1px solid #111827;
            text-align: left;
            white-space: nowrap;
        }
        th {
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: .08em;
            color: #9ca3af;
        }
        tr:last-child td { border-bottom: none; }
        .status-badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 999px;
            font-size: 10px;
            font-weight: 600;
        }
        .status-pending   { background: rgba(250,204,21,.08); color: #eab308; }
        .status-running   { background: rgba(56,189,248,.08); color: #38bdf8; }
        .status-success   { background: rgba(34,197,94,.08); color: #22c55e; }
        .status-failed    { background: rgba(239,68,68,.08); color: #ef4444; }
        .status-cancelled { background: rgba(148,163,184,.08); color: #94a3b8; }
        .tag {
            display: inline-block;
            padding: 2px 6px;
            border-radius: 999px;
            background: #111827;
            font-size: 10px;
            color: #9ca3af;
        }
        @media (max-width: 960px) {
            .cards { grid-template-columns: repeat(2, minmax(0, 1fr)); }
            .grid  { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
<div class="layout">
    <h1>IronRelay Dashboard</h1>
    <div class="subtitle">
        Lightweight task & webhook queue for Django.
    </div>

    <div class="cards">
        <div class="card">
            <div class="card-title">Tasks in queue</div>
            <div class="card-value">{{ stats.pending_tasks }}</div>
            <div class="card-note">Waiting to be processed.</div>
        </div>
        <div class="card">
            <div class="card-title">Running / Locked</div>
            <div class="card-value">{{ stats.running_tasks }}</div>
            <div class="card-note">Taken by workers.</div>
        </div>
        <div class="card">
            <div class="card-title">Failed tasks</div>
            <div class="card-value">{{ stats.failed_tasks }}</div>
            <div class="card-note">Can be retried from admin.</div>
        </div>
        <div class="card">
            <div class="card-title">Delivered webhooks</div>
            <div class="card-value">{{ stats.success_webhooks }}</div>
            <div class="card-note">Successful deliveries.</div>
        </div>
    </div>

    <div class="grid">
        <div class="panel">
            <h2>Recent tasks</h2>
            <table>
                <thead>
                <tr>
                    <th>When</th><th>Name</th><th>Status</th><th>Attempts</th>
                </tr>
                </thead>
                <tbody>
                {% for t in recent_tasks %}
                    <tr>
                        <td>{{ t.created_at|date:"H:i:s" }}</td>
                        <td>{{ t.name }}</td>
                        <td>
                            <span class="status-badge status-{{ t.status|lower }}">
                                {{ t.get_status_display }}
                            </span>
                        </td>
                        <td>{{ t.attempts }}</td>
                    </tr>
                {% empty %}
                    <tr><td colspan="4">No tasks yet.</td></tr>
                {% endfor %}
                </tbody>
            </table>
        </div>

        <div class="panel">
            <h2>Outgoing webhooks</h2>
            <table>
                <thead>
                <tr>
                    <th>When</th><th>Event</th><th>Status</th><th>Code</th>
                </tr>
                </thead>
                <tbody>
                {% for d in outgoing_webhooks %}
                    <tr>
                        <td>{{ d.created_at|date:"H:i:s" }}</td>
                        <td><span class="tag">{{ d.event }}</span></td>
                        <td>
                            <span class="status-badge status-{{ d.status|lower }}">
                                {{ d.get_status_display }}
                            </span>
                        </td>
                        <td>{{ d.last_response_code|default:"—" }}</td>
                    </tr>
                {% empty %}
                    <tr><td colspan="4">No deliveries yet.</td></tr>
                {% endfor %}
                </tbody>
            </table>
        </div>

        <div class="panel">
            <h2>Incoming webhooks</h2>
            <table>
                <thead>
                <tr>
                    <th>When</th><th>Source</th><th>Event</th><th>Status</th>
                </tr>
                </thead>
                <tbody>
                {% for w in incoming_webhooks %}
                    <tr>
                        <td>{{ w.created_at|date:"H:i:s" }}</td>
                        <td><span class="tag">{{ w.source }}</span></td>
                        <td>{{ w.event }}</td>
                        <td>
                            <span class="status-badge status-{{ w.status|lower }}">
                                {{ w.get_status_display }}
                            </span>
                        </td>
                    </tr>
                {% empty %}
                    <tr><td colspan="4">No incoming webhooks yet.</td></tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
</body>
</html>